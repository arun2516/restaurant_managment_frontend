<div class="add-menu-item-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">Add New Menu Item</h1>
      <p class="page-subtitle">Create a new item for your restaurant menu</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-outline" (click)="cancel()">
        <span class="btn-icon">‚Üê</span>
        Back to Menu
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-section">
    <div class="loading-spinner"></div>
    <p>Loading categories...</p>
  </div>

  <!-- Form -->
  <form *ngIf="!isLoading" [formGroup]="addItemForm" (ngSubmit)="onSubmit()" class="add-item-form">
    <div class="form-grid">
      
      <!-- Basic Information Section -->
      <div class="form-section">
        <h2 class="section-title">Basic Information</h2>
        
        <div class="form-row">
          <div class="form-group">
            <label for="name" class="form-label">Item Name *</label>
            <input
              id="name"
              type="text"
              formControlName="name"
              class="form-input"
              [class.error]="getFieldError('name')"
              placeholder="e.g., Caesar Salad">
            <div class="field-error" *ngIf="getFieldError('name')">
              {{ getFieldError('name') }}
            </div>
          </div>

          <div class="form-group">
            <label for="price" class="form-label">Price *</label>
            <div class="input-with-prefix">
              <span class="input-prefix">$</span>
              <input
                id="price"
                type="number"
                step="0.01"
                formControlName="price"
                class="form-input"
                [class.error]="getFieldError('price')"
                placeholder="0.00">
            </div>
            <div class="field-error" *ngIf="getFieldError('price')">
              {{ getFieldError('price') }}
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="description" class="form-label">Description *</label>
          <textarea
            id="description"
            formControlName="description"
            class="form-textarea"
            [class.error]="getFieldError('description')"
            placeholder="Describe your menu item in detail..."
            rows="4"></textarea>
          <div class="field-error" *ngIf="getFieldError('description')">
            {{ getFieldError('description') }}
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="categoryId" class="form-label">Category *</label>
            <select
              id="categoryId"
              formControlName="categoryId"
              class="form-select"
              [class.error]="getFieldError('categoryId')">
              <option value="">Select a category</option>
              <option *ngFor="let category of categories" [value]="category.id">
                {{ category.name }}
              </option>
            </select>
            <div class="field-error" *ngIf="getFieldError('categoryId')">
              {{ getFieldError('categoryId') }}
            </div>
          </div>

          <div class="form-group">
            <label for="preparationTime" class="form-label">Preparation Time *</label>
            <div class="input-with-suffix">
              <input
                id="preparationTime"
                type="number"
                formControlName="preparationTime"
                class="form-input"
                [class.error]="getFieldError('preparationTime')"
                placeholder="15">
              <span class="input-suffix">minutes</span>
            </div>
            <div class="field-error" *ngIf="getFieldError('preparationTime')">
              {{ getFieldError('preparationTime') }}
            </div>
          </div>
        </div>

        <div class="form-group">
          <div class="checkbox-wrapper">
            <input
              id="isAvailable"
              type="checkbox"
              formControlName="isAvailable"
              class="form-checkbox">
            <label for="isAvailable" class="checkbox-label">
              <span class="checkbox-text">Available for ordering</span>
              <span class="checkbox-description">Customers can order this item</span>
            </label>
          </div>
        </div>
      </div>

      <!-- Ingredients Section -->
      <div class="form-section">
        <h2 class="section-title">Ingredients</h2>
        
        <div formArrayName="ingredients" class="ingredients-list">
          <div *ngFor="let ingredient of ingredientsArray.controls; let i = index" 
               [formGroupName]="i" 
               class="ingredient-item">
            <div class="ingredient-input">
              <input
                type="text"
                formControlName="name"
                class="form-input"
                placeholder="e.g., Fresh tomatoes">
            </div>
            <button
              type="button"
              class="btn btn-danger btn-sm"
              (click)="removeIngredient(i)"
              [disabled]="ingredientsArray.length <= 1">
              üóëÔ∏è
            </button>
          </div>
        </div>
        
        <button type="button" class="btn btn-outline btn-sm" (click)="addIngredient()">
          <span class="btn-icon">+</span>
          Add Ingredient
        </button>
      </div>

      <!-- Allergens Section -->
      <div class="form-section">
        <h2 class="section-title">Allergen Information</h2>
        
        <div class="allergens-grid">
         <div *ngFor="let allergen of allergenOptions" class="allergen-item">
            <input
                type="checkbox"
                [id]="'allergen-' + allergen"
                [checked]="isAllergenSelected(allergen)"
                (change)="onAllergenToggle(allergen, $event)"
                class="form-checkbox">
            <label [for]="'allergen-' + allergen" class="allergen-label">
                {{ allergen }}
            </label>
        </div>
        </div>
      </div>

      <!-- Nutritional Information Section -->
      <div class="form-section">
        <h2 class="section-title">Nutritional Information <span class="optional">(Optional)</span></h2>
        
        <div formGroupName="nutritionalInfo" class="nutrition-grid">
          <div class="form-group">
            <label for="calories" class="form-label">Calories</label>
            <input
              id="calories"
              type="number"
              formControlName="calories"
              class="form-input"
              placeholder="250">
          </div>

          <div class="form-group">
            <label for="protein" class="form-label">Protein (g)</label>
            <input
              id="protein"
              type="number"
              step="0.1"
              formControlName="protein"
              class="form-input"
              placeholder="15.5">
          </div>

          <div class="form-group">
            <label for="carbs" class="form-label">Carbs (g)</label>
            <input
              id="carbs"
              type="number"
              step="0.1"
              formControlName="carbs"
              class="form-input"
              placeholder="25.0">
          </div>

          <div class="form-group">
            <label for="fat" class="form-label">Fat (g)</label>
            <input
              id="fat"
              type="number"
              step="0.1"
              formControlName="fat"
              class="form-input"
              placeholder="12.5">
          </div>

          <div class="form-group">
            <label for="fiber" class="form-label">Fiber (g)</label>
            <input
              id="fiber"
              type="number"
              step="0.1"
              formControlName="fiber"
              class="form-input"
              placeholder="3.2">
          </div>
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="form-actions">
      <button type="button" class="btn btn-outline" (click)="cancel()" [disabled]="isSaving">
        Cancel
      </button>
      <button 
        type="submit" 
        class="btn btn-primary"
        [disabled]="addItemForm.invalid || isSaving"
        [class.loading]="isSaving">
        <span *ngIf="!isSaving">
          <span class="btn-icon">üíæ</span>
          Create Menu Item
        </span>
        <span *ngIf="isSaving" class="loading-content">
          <span class="spinner"></span>
          Creating...
        </span>
      </button>
    </div>
  </form>
</div>